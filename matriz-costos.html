<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Matriz de Costos</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <div class="container mt-4">
      <h2 class="fw-bold">Matriz de Costos</h2>

      <!-- Materia Prima -->
      <div class="mt-4">
        <h4>Materia Prima</h4>
        <div class="mb-3">
          <label>Concepto:</label>
          <input
            type="text"
            id="concepto"
            class="form-control"
            placeholder="Ingrese el concepto"
          />
        </div>
        <div class="mb-3">
          <label>Unidad de Medida:</label>
          <input
            type="text"
            id="unidad"
            class="form-control"
            placeholder="Ingrese la unidad de medida"
          />
        </div>
        <div class="mb-3">
          <label>Cantidad:</label>
          <input
            type="number"
            id="cantidad"
            class="form-control"
            placeholder="Ingrese la cantidad"
          />
        </div>
        <div class="mb-3">
          <label>Costo Unitario:</label>
          <input
            type="number"
            id="costo_unitario"
            class="form-control"
            placeholder="Ingrese el costo unitario"
          />
        </div>
        <button class="btn btn-success" onclick="agregarMateriaPrima()">
          Agregar
        </button>
      </div>

      <table class="table table-bordered mt-3">
        <thead class="table-success">
          <tr>
            <th>Concepto</th>
            <th>Unidad</th>
            <th>Cantidad</th>
            <th>Costo Unitario</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody id="tablaMateriaPrima"></tbody>
      </table>

      <!-- Costos Indirectos -->
      <div class="mt-4">
        <h4>Costos Indirectos de Fabricación</h4>
        <div class="mb-3">
          <label>Equipo:</label>
          <input
            type="text"
            id="equipo"
            class="form-control"
            placeholder="Ingrese el equipo"
          />
        </div>
        <div class="mb-3">
          <label>Cantidad:</label>
          <input
            type="number"
            id="cantidadEquipo"
            class="form-control"
            placeholder="Ingrese la cantidad"
          />
        </div>
        <div class="mb-3">
          <label>Costo Unitario:</label>
          <input
            type="number"
            id="costoEquipo"
            class="form-control"
            placeholder="Ingrese el costo unitario"
          />
        </div>
        <button class="btn btn-success" onclick="agregarCIF()">Agregar</button>
      </div>

      <table class="table table-bordered mt-3">
        <thead class="table-success">
          <tr>
            <th>Equipo</th>
            <th>Cantidad</th>
            <th>Costo Unitario</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody id="tablaCIF"></tbody>
      </table>

      <!-- Mano de Obra Directa (Modificado según la imagen) -->
      <div class="mt-4">
        <h4>Mano de Obra Directa</h4>
        <div class="row">
          <div class="col-md-6">
            <div class="card">
              <div class="card-header bg-success text-white">
                <h5 class="mb-0">Cálculo de INSS</h5>
              </div>
              <div class="card-body">
                <div class="mb-3">
                  <label for="totalIngresos">Total Ingresos:</label>
                  <input
                    type="number"
                    id="totalIngresos"
                    class="form-control"
                    placeholder="Ejemplo: 6000"
                  />
                </div>
                <div class="mb-3">
                  <label for="inssLaboral">INSS Laboral (7%):</label>
                  <input
                    type="number"
                    id="inssLaboral"
                    class="form-control"
                    readonly
                  />
                </div>
                <div class="mb-3">
                  <label for="inssPatronal">INSS Patronal (21.5%):</label>
                  <input
                    type="number"
                    id="inssPatronal"
                    class="form-control"
                    readonly
                  />
                </div>
                <div class="mb-3">
                  <label for="totalManoObra">Total Mano de Obra:</label>
                  <input
                    type="number"
                    id="totalManoObra"
                    class="form-control"
                    readonly
                  />
                </div>
                <button id="calcularINSS" class="btn btn-primary w-100">
                  Calcular INSS
                </button>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card">
              <div class="card-header bg-success text-white">
                <h5 class="mb-0">Resumen de Mano de Obra</h5>
              </div>
              <div class="card-body">
                <table class="table table-bordered">
                  <thead class="table-success">
                    <tr>
                      <th>Concepto</th>
                      <th>Valor</th>
                    </tr>
                  </thead>
                  <tbody id="tablaResumenManoObra">
                    <!-- Se llenará dinámicamente -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Resumen General -->
      <h4 class="mt-4">Resumen General</h4>
      <table class="table table-bordered text-center">
        <thead class="table-success">
          <tr>
            <th>Total Ingresos</th>
            <th>INSS Laboral (7%)</th>
            <th>INSS Patronal (21.5%)</th>
            <th>Total Mano de Obra</th>
            <th>Materia Prima Total</th>
            <th>CIF Total</th>
          </tr>
        </thead>
        <tbody id="tablaManoObra"></tbody>
      </table>
    </div>

    <script>
      // Función para agregar Materia Prima
      function agregarMateriaPrima() {
        let concepto = document.getElementById("concepto").value;
        let unidad = document.getElementById("unidad").value;
        let cantidad = document.getElementById("cantidad").value;
        let costo = document.getElementById("costo_unitario").value;
        let total = cantidad * costo;

        // Agregar la nueva fila a la tabla de Materia Prima
        let fila = `<tr><td>${concepto}</td><td>${unidad}</td><td>${cantidad}</td><td>${costo}</td><td>${total}</td></tr>`;
        document.getElementById("tablaMateriaPrima").innerHTML += fila;
      }

      // Función para agregar Costos Indirectos de Fabricación
      function agregarCIF() {
        let equipo = document.getElementById("equipo").value;
        let cantidad = document.getElementById("cantidadEquipo").value;
        let costo = document.getElementById("costoEquipo").value;
        let total = cantidad * costo;

        // Agregar la nueva fila a la tabla de CIF
        let fila = `<tr><td>${equipo}</td><td>${cantidad}</td><td>${costo}</td><td>${total}</td></tr>`;
        document.getElementById("tablaCIF").innerHTML += fila;
      }

      // Función para calcular INSS y mostrarlo en el resumen
      document
        .getElementById("calcularINSS")
        .addEventListener("click", function () {
          let totalIngresos = parseFloat(
            document.getElementById("totalIngresos").value
          );

          if (!isNaN(totalIngresos)) {
            // Cálculo de INSS
            let inssLaboral = totalIngresos * 0.07; // 7%
            let inssPatronal = totalIngresos * 0.215; // 21.5%
            let totalManoObra = totalIngresos + inssPatronal; // Total ingresos + INSS patronal

            // Mostrar los valores de INSS en los campos correspondientes
            document.getElementById("inssLaboral").value =
              inssLaboral.toFixed(2);
            document.getElementById("inssPatronal").value =
              inssPatronal.toFixed(2);
            document.getElementById("totalManoObra").value =
              totalManoObra.toFixed(2);

            // Obtener los totales de Materia Prima
            let totalMateriaPrima = 0;
            let filasMateriaPrima = document.querySelectorAll(
              "#tablaMateriaPrima tr"
            );
            filasMateriaPrima.forEach((fila) => {
              let columnas = fila.querySelectorAll("td");
              if (columnas.length > 0) {
                totalMateriaPrima += parseFloat(columnas[4].innerText);
              }
            });

            // Obtener los totales de CIF
            let totalCIF = 0;
            let filasCIF = document.querySelectorAll("#tablaCIF tr");
            filasCIF.forEach((fila) => {
              let columnas = fila.querySelectorAll("td");
              if (columnas.length > 0) {
                totalCIF += parseFloat(columnas[3].innerText);
              }
            });

            // Actualizar la tabla de resumen de mano de obra
            let resumenManoObra = `
            <tr><td>Total Ingresos</td><td>${totalIngresos.toFixed(2)}</td></tr>
            <tr><td>INSS Laboral (7%)</td><td>${inssLaboral.toFixed(
              2
            )}</td></tr>
            <tr><td>INSS Patronal (21.5%)</td><td>${inssPatronal.toFixed(
              2
            )}</td></tr>
            <tr><td>Total Mano de Obra</td><td>${totalManoObra.toFixed(
              2
            )}</td></tr>
          `;
            document.getElementById("tablaResumenManoObra").innerHTML =
              resumenManoObra;

            // Mostrar el resumen general en la tabla
            let filaResumen = `
            <tr>
              <td>${totalIngresos.toFixed(2)}</td>
              <td>${inssLaboral.toFixed(2)}</td>
              <td>${inssPatronal.toFixed(2)}</td>
              <td>${totalManoObra.toFixed(2)}</td>
              <td>${totalMateriaPrima.toFixed(2)}</td>
              <td>${totalCIF.toFixed(2)}</td>
            </tr>`;
            document.getElementById("tablaManoObra").innerHTML = filaResumen;
          } else {
            alert(
              "Por favor ingresa un valor válido en el campo Total Ingresos."
            );
          }
        });
    </script>
  </body>
</html>
