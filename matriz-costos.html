<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Matriz de Costos</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.9/font/bootstrap-icons.min.css"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
      datalist {
        background-color: white;
      }
      input::-webkit-calendar-picker-indicator {
        background-color: white;
      }
    </style>
  </head>
  <body>
    <div class="container mt-4">
      <!-- Agrega esto justo después del <h2 class="fw-bold">Matriz de Costos</h2> -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold mb-0">Matriz de Costos</h2>
        <button onclick="cerrarSesion()" class="btn btn-danger">
          <i class="bi bi-box-arrow-right"></i> Cerrar Sesión
        </button>
      </div>

      <!-- Materia Prima -->
      <div class="mt-4">
        <h4>Materia Prima</h4>
        <div class="mb-3">
          <label>Concepto:</label>
          <input
            type="text"
            id="concepto"
            class="form-control"
            placeholder="Ingrese el concepto"
          />
        </div>
        <!-- Modificar en la sección de Materia Prima, el campo de unidad de medida -->
        <div class="mb-3">
          <label>Unidad de Medida:</label>
          <input
            type="text"
            id="unidad"
            class="form-control"
            placeholder="Ingrese la unidad de medida"
            list="unidadesMedida"
          />
          <datalist id="unidadesMedida" class="bg-white">
            <option value="Metros"></option>
            <option value="Libras"></option>
            <option value="Litros"></option>
            <option value="Kilogramos"></option>
            <option value="Gramos"></option>
            <option value="Milímetros cúbicos"></option>
            <option value="Unidades"></option>
            <option value="Docenas"></option>
            <option value="Galones"></option>
          </datalist>
        </div>
        <div class="mb-3">
          <label>Cantidad:</label>
          <input
            type="number"
            id="cantidad"
            class="form-control"
            placeholder="Ingrese la cantidad"
          />
        </div>
        <div class="mb-3">
          <label>Costo Unitario:</label>
          <input
            type="number"
            id="costo_unitario"
            class="form-control"
            placeholder="Ingrese el costo unitario"
          />
        </div>
        <!-- Modificar la sección de botones en Materia Prima -->
        <div class="mb-3 d-flex gap-2">
          <button class="btn btn-success" onclick="agregarMateriaPrima()">
            <i class="bi bi-plus-circle"></i> Agregar
          </button>
        </div>
      </div>

      <!-- Modificar la tabla de Materia Prima -->
      <table class="table table-bordered mt-3">
        <thead class="table-primary">
          <tr>
            <th>Concepto</th>
            <th>Unidad</th>
            <th>Cantidad</th>
            <th>Costo Unitario</th>
            <th>Total</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="tablaMateriaPrima"></tbody>
      </table>

      <!-- Costos Indirectos -->
      <div class="mt-4">
        <h4>Costos Indirectos de Fabricación</h4>
        <!-- Modificar en la sección de Costos Indirectos, el campo de equipo -->
        <div class="mb-3">
          <label>Equipo:</label>
          <input
            type="text"
            id="equipo"
            class="form-control"
            placeholder="Ingrese el equipo"
            list="equiposCIF"
          />
          <datalist id="equiposCIF" class="bg-white">
            <option value="Agua"></option>
            <option value="Luz"></option>
            <option value="Calefacción"></option>
            <option value="Maquinaria"></option>
            <option value="Equipos Informáticos"></option>
            <option value="Mantenimiento"></option>
          </datalist>
        </div>
        <div class="mb-3">
          <label>Cantidad:</label>
          <input
            type="number"
            id="cantidadEquipo"
            class="form-control"
            placeholder="Ingrese la cantidad"
          />
        </div>
        <div class="mb-3">
          <label>Costo Unitario:</label>
          <input
            type="number"
            id="costoEquipo"
            class="form-control"
            placeholder="Ingrese el costo unitario"
          />
        </div>
        <!-- Modificar la sección de botones en CIF -->
        <div class="mb-3 d-flex gap-2">
          <button class="btn btn-success" onclick="agregarCIF()">
            <i class="bi bi-plus-circle"></i> Agregar
          </button>
        </div>
      </div>

      <!-- Modificar la tabla de CIF para incluir la columna de acciones -->
      <table class="table table-bordered mt-3">
        <thead class="table-primary">
          <tr>
            <th>Equipo</th>
            <th>Cantidad</th>
            <th>Costo Unitario</th>
            <th>Total</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="tablaCIF"></tbody>
      </table>

      <!-- Mano de Obra Directa (Modificado según la imagen) -->
      <div class="mt-4">
        <h4>Mano de Obra Directa</h4>
        <div class="row">
          <div class="col-md-6">
            <!-- Modificar la sección de Mano de Obra -->
            <div class="card">
              <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Cálculo de INSS e IR</h5>
              </div>
              <div class="card-body">
                <div class="mb-3">
                  <label for="nombreEmpleado">Nombre del Empleado:</label>
                  <input
                    type="text"
                    id="nombreEmpleado"
                    class="form-control"
                    placeholder="Ingrese el nombre"
                  />
                </div>
                <div class="mb-3">
                  <label for="cargo">Cargo:</label>
                  <input
                    type="text"
                    id="cargo"
                    class="form-control"
                    placeholder="Ingrese el cargo"
                  />
                </div>
                <div class="mb-3">
                  <label for="pagoMensual">Pago Mensual:</label>
                  <input
                    type="number"
                    id="pagoMensual"
                    class="form-control"
                    placeholder="Ingrese el pago mensual"
                  />
                </div>
                <div class="mb-3">
                  <label for="horasExtras">Horas Extras:</label>
                  <input
                    type="number"
                    id="horasExtras"
                    class="form-control"
                    placeholder="Ingrese las horas extras"
                  />
                </div>
                <div class="mb-3">
                  <label for="ir">IR (6.5%):</label>
                  <input type="number" id="ir" class="form-control" readonly />
                </div>
                <div class="mb-3">
                  <label for="inssLaboral">INSS Laboral (7%):</label>
                  <input
                    type="number"
                    id="inssLaboral"
                    class="form-control"
                    readonly
                  />
                </div>
                <div class="mb-3">
                  <label for="inssPatronal">INSS Patronal (21.5%):</label>
                  <input
                    type="number"
                    id="inssPatronal"
                    class="form-control"
                    readonly
                  />
                </div>
                <div class="mb-3">
                  <label for="totalManoObra">Total Mano de Obra:</label>
                  <input
                    type="number"
                    id="totalManoObra"
                    class="form-control"
                    readonly
                  />
                </div>
                <button id="calcularINSS" class="btn btn-primary w-100">
                  Calcular
                </button>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card">
              <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Resumen de Mano de Obra</h5>
              </div>
              <div class="card-body">
                <table class="table table-bordered">
                  <thead class="table-primary">
                    <tr>
                      <th>Concepto</th>
                      <th>Valor</th>
                    </tr>
                  </thead>
                  <tbody id="tablaResumenManoObra">
                    <!-- Se llenará dinámicamente -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Resumen General -->
      <h4 class="mt-4">Resumen General</h4>
      <table class="table table-bordered text-center">
        <thead class="table-primary">
          <tr>
            <th>Total Ingresos</th>
            <th>INSS Laboral (7%)</th>
            <th>INSS Patronal (21.5%)</th>
            <th>Total Mano de Obra</th>
            <th>Materia Prima Total</th>
            <th>CIF Total</th>
          </tr>
        </thead>
        <tbody id="tablaManoObra"></tbody>
      </table>
    </div>

    <script>
      // Función para agregar Materia Prima
      function agregarMateriaPrima() {
        let concepto = document.getElementById("concepto").value;
        let unidad = document.getElementById("unidad").value;
        let cantidad = document.getElementById("cantidad").value;
        let costo = document.getElementById("costo_unitario").value;
        let total = cantidad * costo;

        // Agregar la nueva fila a la tabla de Materia Prima con botón de eliminar
        let fila = `
    <tr>
      <td>${concepto}</td>
      <td>${unidad}</td>
      <td>${cantidad}</td>
      <td>${costo}</td>
      <td>${total}</td>
      <td>
        <button class="btn btn-danger btn-sm" onclick="eliminarFila(this)">
          <i class="bi bi-trash"></i>
        </button>
      </td>
    </tr>`;
        document.getElementById("tablaMateriaPrima").innerHTML += fila;
      }

      function eliminarFila(boton) {
        // Obtener la fila y eliminarla
        let fila = boton.closest("tr");
        fila.remove();
      }

      // Función para agregar Costos Indirectos de Fabricación
      function agregarCIF() {
        let equipo = document.getElementById("equipo").value;
        let cantidad = document.getElementById("cantidadEquipo").value;
        let costo = document.getElementById("costoEquipo").value;
        let total = cantidad * costo;

        // Agregar la nueva fila a la tabla de CIF con botón de eliminar
        let fila = `
    <tr>
      <td>${equipo}</td>
      <td>${cantidad}</td>
      <td>${costo}</td>
      <td>${total}</td>
      <td>
        <button class="btn btn-danger btn-sm" onclick="eliminarFila(this)">
          <i class="bi bi-trash"></i>
        </button>
      </td>
    </tr>`;
        document.getElementById("tablaCIF").innerHTML += fila;
      }

      document
        .getElementById("calcularINSS")
        .addEventListener("click", function () {
          // Obtener valores de los campos
          let nombreEmpleado = document.getElementById("nombreEmpleado").value;
          let cargo = document.getElementById("cargo").value;
          let pagoMensual =
            parseFloat(document.getElementById("pagoMensual").value) || 0;
          let horasExtras =
            parseFloat(document.getElementById("horasExtras").value) || 0;

          // Validar campos requeridos
          if (!nombreEmpleado || !cargo || pagoMensual === 0) {
            alert("Por favor complete todos los campos requeridos");
            return;
          }

          // Calcular total de ingresos
          let totalIngresos = pagoMensual + horasExtras;

          // Cálculos de INSS y IR
          let inssLaboral = totalIngresos * 0.07; // 7%
          let inssPatronal = totalIngresos * 0.215; // 21.5%
          let ir = totalIngresos >= 10000 ? totalIngresos * 0.065 : 0; // 6.5% si supera 10000
          let totalManoObra = totalIngresos + inssPatronal;

          // Mostrar resultados en los campos
          document.getElementById("inssLaboral").value = inssLaboral.toFixed(2);
          document.getElementById("inssPatronal").value =
            inssPatronal.toFixed(2);
          document.getElementById("ir").value = ir.toFixed(2);
          document.getElementById("totalManoObra").value =
            totalManoObra.toFixed(2);

          // Actualizar tabla de resumen
          let resumenManoObra = `
          <tr><td>Nombre del Empleado</td><td>${nombreEmpleado}</td></tr>
          <tr><td>Cargo</td><td>${cargo}</td></tr>
          <tr><td>Pago Mensual</td><td>${pagoMensual.toFixed(2)}</td></tr>
          <tr><td>Horas Extras</td><td>${horasExtras.toFixed(2)}</td></tr>
          <tr><td>Total Ingresos</td><td>${totalIngresos.toFixed(2)}</td></tr>
          <tr><td>INSS Laboral (7%)</td><td>${inssLaboral.toFixed(2)}</td></tr>
          <tr><td>INSS Patronal (21.5%)</td><td>${inssPatronal.toFixed(
            2
          )}</td></tr>
          <tr><td>IR (6.5%)</td><td>${ir.toFixed(2)}</td></tr>
          <tr><td>Total Mano de Obra</td><td>${totalManoObra.toFixed(
            2
          )}</td></tr>
        `;
          document.getElementById("tablaResumenManoObra").innerHTML =
            resumenManoObra;

          // Actualizar resumen general
          let filaResumen = `
          <tr>
            <td>${totalIngresos.toFixed(2)}</td>
            <td>${inssLaboral.toFixed(2)}</td>
            <td>${inssPatronal.toFixed(2)}</td>
            <td>${totalManoObra.toFixed(2)}</td>
            <td>${calcularTotalMateriaPrima().toFixed(2)}</td>
            <td>${calcularTotalCIF().toFixed(2)}</td>
          </tr>`;
          document.getElementById("tablaManoObra").innerHTML = filaResumen;
        });

      // Funciones auxiliares para calcular totales
      function calcularTotalMateriaPrima() {
        let total = 0;
        let filas = document.querySelectorAll("#tablaMateriaPrima tr");
        filas.forEach((fila) => {
          let columnas = fila.querySelectorAll("td");
          if (columnas.length > 0) {
            total += parseFloat(columnas[4].innerText);
          }
        });
        return total;
      }

      function calcularTotalCIF() {
        let total = 0;
        let filas = document.querySelectorAll("#tablaCIF tr");
        filas.forEach((fila) => {
          let columnas = fila.querySelectorAll("td");
          if (columnas.length > 0) {
            total += parseFloat(columnas[3].innerText);
          }
        });
        return total;
      }
    </script>
    <!-- Agrega este script al final del archivo, justo antes de </body> -->
    <script>
      function cerrarSesion() {
        // Puedes agregar aquí cualquier limpieza de datos que necesites
        localStorage.removeItem("usuario"); // Elimina el usuario guardado si existe
        window.location.href = "login.html"; // Redirecciona al login
      }
    </script>
  </body>
</html>
